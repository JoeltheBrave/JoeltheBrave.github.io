<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Data Editor</title>
    <style>
        /* Your styles go here */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .edit-btn {
            cursor: pointer;
            color: blue;
            text-decoration: underline;
        }
    </style>
</head>
<body>

<h1>JSON Data Editor</h1>

<!-- Display current videos from video_details.json -->
<h2>All Videos from video_details.json</h2>
<table id="videosTable">
    <thead>
        <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Published At</th>
            <th>Video ID</th>
            <th>URL</th>
            <th>Views</th>
            <th>Artist</th>
            <th>Band Members</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- Form to edit selected video -->
<h2>Edit Video</h2>
<form id="editForm">
    <label for="editTitle">Title:</label>
    <input type="text" id="editTitle" name="editTitle" required><br>

    <label for="editDescription">Description:</label>
    <textarea id="editDescription" name="editDescription" required></textarea><br>

    <label for="editPublishedAt">Published At:</label>
    <input type="datetime-local" id="editPublishedAt" name="editPublishedAt" required><br>

    <label for="editVideoId">Video ID:</label>
    <input type="text" id="editVideoId" name="editVideoId" required><br>

    <label for="editUrl">URL:</label>
    <input type="url" id="editUrl" name="editUrl" required><br>

    <label for="editViews">Views:</label>
    <input type="number" id="editViews" name="editViews" required><br>

    <label for="editArtist">Artist:</label>
    <input type="text" id="editArtist" name="editArtist" required><br>

    <label for="editBandMembers">Band Members (comma-separated):</label>
    <input type="text" id="editBandMembers" name="editBandMembers" required><br>

    <button type="button" onclick="saveEditedVideo()">Save</button>
</form>

<!-- Upload to GitHub button -->
<button onclick="uploadToGitHub()">Upload to GitHub</button>

<script>
    let currentVideosData; // Store the fetched videos data

    // Fetch and display all videos from video_details.json
    async function fetchAndDisplayAllVideos() {
        const responseDetails = await fetch('https://raw.githubusercontent.com/joelthebrave/joelthebrave.github.io/main/video_details.json');
        const dataDetails = await responseDetails.json();

        const videosTableBody = document.querySelector('#videosTable tbody');
        videosTableBody.innerHTML = '';

        dataDetails.forEach(video => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${video.title}</td>
                <td>${video.description}</td>
                <td>${video.publishedAt}</td>
                <td>${video.videoId}</td>
                <td>${video.url}</td>
                <td>${video.views}</td>
                <td>${video.artist}</td>
                <td>${video.bandMembers.join(', ')}</td>
                <td><span class="edit-btn" onclick="editVideo(${dataDetails.indexOf(video)})">Edit</span></td>
            `;
            videosTableBody.appendChild(row);
        });

        // Store the fetched videos data
        currentVideosData = dataDetails;
    }

    // Function to edit selected video
    function editVideo(index) {
        const selectedVideo = currentVideosData[index];

        document.getElementById('editTitle').value = selectedVideo.title;
        document.getElementById('editDescription').value = selectedVideo.description;
        document.getElementById('editPublishedAt').value = selectedVideo.publishedAt;
        document.getElementById('editVideoId').value = selectedVideo.videoId;
        document.getElementById('editUrl').value = selectedVideo.url;
        document.getElementById('editViews').value = selectedVideo.views;
        document.getElementById('editArtist').value = selectedVideo.artist;
        document.getElementById('editBandMembers').value = selectedVideo.bandMembers.join(', ');

        // Scroll to the edit form
        document.getElementById('editForm').scrollIntoView({ behavior: 'smooth' });
    }

    // Function to save edited video
    function saveEditedVideo() {
        const editedVideo = {
            title: document.getElementById('editTitle').value,
            description: document.getElementById('editDescription').value,
            publishedAt: document.getElementById('editPublishedAt').value,
            videoId: document.getElementById('editVideoId').value,
            url: document.getElementById('editUrl').value,
            views: document.getElementById('editViews').value,
            artist: document.getElementById('editArtist').value,
            bandMembers: document.getElementById('editBandMembers').value.split(',').map(member => member.trim()),
        };

        // Update the video data in the currentVideosData array
        const selectedIndex = currentVideosData.findIndex(video => video.title === editedVideo.title);
        if (selectedIndex !== -1) {
            currentVideosData[selectedIndex] = editedVideo;
        }

        // Re-render the videos table
        fetchAndDisplayAllVideos();
    }

    // Function to upload data to GitHub
    async function uploadToGitHub() {
        const githubToken = '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';

        // Fetch current content of video_details.json from GitHub
        const responseDetails = await fetch('https://api.github.com/repos/joelthebrave/joelthebrave.github.io/contents/video_details.json', {
            headers: {
                Authorization: `Bearer ${githubToken}`,
            },
        });

        const dataDetails = await responseDetails.json();
        const currentDetailsData = JSON.parse(atob(dataDetails.content));

        // Update the content of video_details.json with the edited data
        await fetch('https://api.github.com/repos/joelthebrave/joelthebrave.github.io/contents/video_details.json', {
            method: 'PUT',
            headers: {
                Authorization: `Bearer ${githubToken}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                message: 'Update video_details.json with edited data',
                content: btoa(JSON.stringify(currentDetailsData)),
                sha: dataDetails.sha,
            }),
        });
    }

    // Fetch and display videos on page load
    fetchAndDisplayAllVideos();
</script>

</body>
</html>
